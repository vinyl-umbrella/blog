---
title: curl -I ではなく，curl -i を使おう
pubDate: 2023-12-03
description: curl のオプションである -I と -i の違いについて
tags: ['tips']
---

[curl](https://github.com/curl/curl) はみんな大好き CLIのHTTPクライアントです．

歴史あるツールであり，豊富なオプションのため，UNIX系OSユーザなら誰もが使ったことがあるでしょう．

最近，`curl -I`を使って失敗したことがあったので，ここに記しておきます．

## `-I` と `-i`

`-I` と `-i` は，それぞれ以下のようなオプションです．

- `-I` : ヘッダのみを表示
- `-i` : ヘッダとボディを表示

### `-I` の罠

レスポンスが長くて，ボディはいらない・レスポンスヘッダのみが欲しいときは`-I`を使うと便利そうに見えますが，ここに罠がありました．

```sh
curl -I "https://my-api.example.com"
# HTTP/2 405
# date: Sat, 03 Dec 2023 12:00:00 GMT
# ...
```

なんと405が返ってきてしまいました．
405なので許可されていないメソッドであるですが，そのときの私は，サーバが落ちたのではないかと勘違いしてしまいました．
焦りますよね．

[curl のドキュメント](https://curl.se/docs/manpage.html)を見ると，`-I`は`HEAD`メソッドを使ってリクエストを送ると書いてあります．

私のアプリケーションでは，`GET`, `POST`以外を405にしていたので，`-I`では405が返ってくるのは当然でした．

### `-i` を使おう

`-i`を使うと確かに，200が返ってきました．ただし，ボディを含んでしまいます．

そこで，`-D -` を使い，レスポンスヘッダを標準出力に出し，`-o /dev/null`でボディを捨てることで，実現したかったものが得られます．

```sh
curl -s -D - -o /dev/null "https://my-api.example.com"

# HTTP/2 200
# date: Sat, 03 Dec 2023 12:00:00 GMT
# ...
```
